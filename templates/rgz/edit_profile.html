{% extends "base.html" %}
{% block script %}
<script>
    function editProfile() {
        fetch('/api/edit_profile', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                return response.json();
            } else {
                alert('Ошибка при получении данных профиля');
            }
        }).then(user => {
            // Populate the edit form with user data
            document.getElementById('full_name').value = user.full_name;
            document.getElementById('age').value = user.age;
            document.getElementById('gender').value = user.gender;
            document.getElementById('search_gender').value = user.search_gender;
            document.getElementById('about').value = user.about;
            document.getElementById('photo_url').value = user.photo;
            // Show the edit form (you may need to implement this part)
        });
    }
    function submitEditProfile(event) {
        event.preventDefault();  // Prevent the default form submission

        const data = {
            full_name: document.getElementById('full_name').value,
            age: document.getElementById('age').value,
            gender: document.getElementById('gender').value,
            search_gender: document.getElementById('search_gender').value,
            about: document.getElementById('about').value,
            photo_url: document.getElementById('photo_url').value
        };

        fetch('/api/edit_profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => {
            if (response.ok) {
                alert('Профиль успешно обновлён');
                window.location.href = '/rgz/profile';  // Redirect to profile view
            } else {
                return response.json().then(error => {
                    alert('Ошибка при обновлении профиля: ' + error.error);
                });
            }
        }).catch(error => {
            alert('Ошибка при обновлении профиля: ' + error);
        });
    }
</script>
{% endblock %}
{% block main %}
    <h1>Редактировать анкету</h1>

    <form id="editProfileForm" method="POST" onsubmit="submitEditProfile(event)">
        <label for="full_name">Полное имя:</label>
        <input type="text" id="full_name" name="full_name" value="{{ user.full_name }}" required>

        <label for="age">Возраст:</label>
        <input type="number" id="age" name="age" value="{{ user.age }}" required>

        <label for="gender">Пол:</label>
        <select id="gender" name="gender" required>
            <option value="male" {% if user.gender == 'male' %}selected{% endif %}>Мужской</option>
            <option value="female" {% if user.gender == 'female' %}selected{% endif %}>Женский</option>
        </select>

        <label for="search_gender">Ищете:</label>
        <select id="search_gender" name="search_gender" required>
            <option value="male" {% if user.search_gender == 'male' %}selected{% endif %}>Мужчин</option>
            <option value="female" {% if user.search_gender == 'female' %}selected{% endif %}>Женщин</option>
        </select>

        <label for="about">О себе:</label>
        <textarea id="about" name="about">{{ user.about }}</textarea>

        <label for="photo_url">URL фотографии:</label>
        <input type="text" id="photo_url" name="photo_url" value="{{ user.photo }}">

        <button type="submit">Сохранить изменения</button>
    </form>
    <a href="{{ url_for('rgz.profile_view') }}">Назад к профилю</a>
{% endblock %}