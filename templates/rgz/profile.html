{% block script %}
<script>
    function editProfile() {
        window.location.href = '{{ url_for("rgz.edit_profile_view") }}';  // Перенаправление на страницу редактирования профиля
    }

    function deleteAccount() {
        if (confirm('Вы уверены, что хотите удалить свой аккаунт?')) {
            fetch('/api/delete_account', {
                method: 'DELETE'
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/rgz/';  // Перенаправление на главную страницу
                } else {
                    alert('Ошибка при удалении аккаунта');
                }
            });
        }
    }

    function logout() {
        fetch('/api/logout', {
            method: 'POST'
        }).then(response => {
            if (response.ok) {
                window.location.href = '/rgz/';  // Перенаправление на главную страницу
            } else {
                alert('Ошибка при выходе');
            }
        });
    }
    function hideProfile() {
        fetch('/api/hide_profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                alert('Профиль скрыт');
                document.getElementById('toggleProfileButton').innerText = 'Открыть анкету'; // Изменяем текст кнопки
            } else {
                return response.json().then(error => {
                    alert('Ошибка при скрытии профиля: ' + error.error);
                });
            }
        }).catch(error => {
            alert('Ошибка при скрытии профиля: ' + error);
        });
    }
    
    function openProfile() {
        fetch('/api/open_profile', {
            method: 'POST'
        }).then(response => {
            if (response.ok) {
                alert('Анкета открыта');
                document.getElementById('toggleProfileButton').innerText = 'Скрыть анкету'; // Изменяем текст кнопки
            } else {
                return response.json().then(error => {
                    alert('Ошибка при открытии анкеты: ' + error.error);
                });
            }
        }).catch(error => {
            alert('Ошибка при открытии анкеты: ' + error);
        });
    }
    function toggleProfile() {
        const button = document.getElementById('toggleProfileButton');
        const isHidden = button.innerText === 'Открыть анкету';
    
        if (isHidden) {
            openProfile();
        } else {
            hideProfile();
        }
    }
</script>
{% endblock %}

{% block main %}
    <h1>Добро пожаловать, {{ user.full_name }}</h1>

    <div>
        <h2>Информация о вас:</h2>
        <p><strong>Имя:</strong> {{ user.full_name }}</p>
        <p><strong>Возраст:</strong> {{ user.age }}</p>
        <p><strong>О себе:</strong> {{ user.about }}</p>
        
        {% if user.photo %}
            <h2>Ваша фотография профиля:</h2>
            <img src="{{ user.photo }}" alt="Profile Picture" width="240" height="240">
        {% endif %}
    </div>

    <button onclick="editProfile()">Редактировать анкету</button>
    <button id="toggleProfileButton" onclick="toggleProfile()">
        {% if user.is_hidden %}Открыть анкету{% else %}Скрыть анкету{% endif %}
    </button>
    <button onclick="deleteAccount()">Удалить аккаунт</button>
    <button onclick="logout()">Выйти</button>

    <a href="{{ url_for('rgz.list_users') }}">Посмотреть всех пользователей</a>
{% endblock %}