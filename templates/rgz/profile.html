{% block script %}
<script>
    document.getElementById('profile-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        fetch('/api/profile', {
            method: 'PUT',
            body: JSON.stringify(Object.fromEntries(formData)),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message || 'Ошибка при обновлении профиля');
        });
    });

    document.getElementById('delete-account').addEventListener('click', function() {
        if (confirm('Вы уверены, что хотите удалить свой аккаунт?')) {
            fetch('/api/profile', {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || 'Ошибка при удалении аккаунта');
                if (data.message) {
                    window.location.href = '/rgz/login'; // Перенаправление на страницу входа
                }
            });
        }
    });
</script>
{% endblock %}
{% block main %}
    <h1>Добро пожаловать, {{ user.full_name }}</h1>

    {% if user.profile_picture %}
        <div>
            <h2>Ваша фотография профиля:</h2>
            <img src="{{ url_for('static', filename=user.profile_picture) }}" alt="Profile Picture" width="240" height="240">
        </div>
    {% else %}
        <p>Фотография профиля не загружена.</p>
    {% endif %}
        
    <form id="profile-form">
        <label for="full_name">Полное имя:</label>
        <input type="text" id="full_name" name="full_name" value="{{ user.full_name }}" required>
        <br>
        <label for="age">Возраст:</label>
        <input type="number" id="age" name="age" value="{{ user.age }}" required>
        <br>
        <label for="gender">Пол:</label>
        <select id="gender" name="gender" required>
            <option value="male" {% if user.gender == 'male' %}selected{% endif %}>Мужской</option>
            <option value="female" {% if user.gender == 'female' %}selected{% endif %}>Женский</option>
            <option value="other" {% if user.gender == 'other' %}selected{% endif %}>Другой</option>
        </select>
        <br>
        <label for="search_gender">Пол для поиска:</label>
        <select id="search_gender" name="search_gender" required>
            <option value="male" {% if user.search_gender == 'male' %}selected{% endif %}>Мужской</option>
            <option value="female" {% if user.search_gender == 'female' %}selected{% endif %}>Женский</option>
            <option value="other" {% if user.search_gender == 'other' %}selected{% endif %}>Другой</option>
        </select>
        <br>
        <label for="about">О себе:</label>
        <textarea id="about" name="about">{{ user.about }}</textarea>
        <br>
        <label for="is_hidden">Скрыть анкету:</label>
        <input type="checkbox" id="is_hidden" name="is_hidden" {% if user.is_hidden %}checked{% endif %}>
        <br>
        <button type="submit">Сохранить изменения</button>
    </form>

    <button id="delete-account">Удалить аккаунт</button>

{% endblock %}